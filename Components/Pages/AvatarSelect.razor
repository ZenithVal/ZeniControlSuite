@page "/AvatarSelect"
@using Microsoft.AspNetCore.Components.Authorization
@using Microsoft.AspNetCore.Authorization
@using ZeniControlSuite.Authentication
@using ZeniControlSuite.Models
@using MudBlazor.Services
@using MudBlazor.Utilities
@attribute [Authorize(Roles = "Admin, Avatar")]

<PageTitle>Avatar Controls</PageTitle>

<h1 style="text-align: Left;">Avatar Select</h1>

<MudDivider/>
<div style="height: 8px"></div>

<AuthorizeView>
    <Authorized>
        @if (@context.User.IsInRole("Admin")) 
        {
            <MudPaper Style="width: 400px; padding-left: 12px; padding-right: 12px; padding-top: 12px; padding-bottom: 12px" Class="mt-2; p-2;">
                <MudButton Variant="Variant.Outlined" Style="text-transform:none"  OnClick="ToggleAdminPanel">@(adminPanelExpand ? "Admin (Collapse)" : "Admin (Expand)")</MudButton>
                <MudCollapse Expanded="adminPanelExpand">
                    <MudSwitch @bind-Value="AvatarsService.avatarSelectEnabled" Label="Avatar Select Allowed" Color="Color.Info" />
                    <MudSwitch @bind-Value="AvatarsService.avatarSelectFree" Label="Avatar Select Free?" Color="Color.Info" />
                    <MudNumericField @bind-Value="AvatarsService.avatarSelectCostMulti" Label="Avatar Cost Multiplier" Color="Color.Info" Step="0.25" Min="1.0" />
                </MudCollapse>
            </MudPaper>
            <div style="height: 8px"></div>
        }
        <MudGrid Spacing="3" Justify="Justify.FlexStart">
            @foreach (Avatar avatar in AvatarsService.avatars)
            {
                if (!avatar.Selectable)
                {
                    continue;
                }
                if (!avatar.Available && !@context.User.IsInRole("LocalHost"))
                {
                    continue;
                }
                if (!AvatarsService.avatarSelectEnabled && !@context.User.IsInRole("LocalHost"))
                {
                    continue;
                }
                <MudItem>
                    <MudPaper Style="width: 230px; padding-left: 12px; padding-right: 12px; padding-top: 12px; padding-bottom: 12px" Class="mt-2; justify-center; align-start; p-2; border-1">

                        <div style="posiition: absolute; width: 100%; height: 32px; background: rgba(0, 0, 0, 0.0)">
                        <MudText Typo="Typo.h6" Align="Align.Center">@avatar.Name.Split('|')[1].Trim()</MudText>
                        </div>
                        <MudImage Width="207" Class="rounded-lg" Src="@avatar.Thumbnail" Alt="@avatar.Name" />

                        <div style="height: 8px"></div>
                        <MudDivider />


                        @if (AvatarsService.avatarSelectFree)
                        {
                            <MudButton Variant="Variant.Filled" Style="width: 100%;" Color="Color.Primary" OnClick="@(() => { SelectAvatar(avatar); })">Select Avatar</MudButton>
                        }
                        else
                        {
                            double cost = avatar.Cost * AvatarsService.avatarSelectCostMulti;
                            <MudButton Variant="Variant.Filled" Style="width: 100%;" Color="Color.Primary" OnClick="@(() => { SelectAvatar(avatar); })">Select - @cost Points</MudButton>
                        }

                        @if (@context.User.IsInRole("LocalHost") && adminPanelExpand)
                        {
                            <div style="height: 8px"></div>
                            <MudDivider />
                            <MudSwitch @bind-Value="avatar.Available" Label="Available" Color="Color.Info" />
                        }
                    </MudPaper>
                </MudItem>
            }
        </MudGrid>

    </Authorized>
</AuthorizeView>