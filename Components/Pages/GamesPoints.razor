@page "/Points&Games"

<PageTitle>Points & Games</PageTitle>

<h1>Games & Points</h1>
<MudDivider></MudDivider>
&nbsp;

<MudGrid Style="width: 1500px; height: 100px">

    @* Points *@
    <MudItem xs="3">
	    @* <h2>Points</h2> *@
        <MudGrid Justify="Justify.Center" Style="width: 380px;align-items:center">
            <MudItem xs="4">
                <MudButton Variant="Variant.Filled" Color="Color.Success" OnClick="btnAddWhole" Style="background-color: #00C853; color: white; width: 88px; height: 62px; font-size: 18pt;">+1</MudButton>
            </MudItem>
            <MudItem xs="4">
                <MudButton Variant="Variant.Filled" Color="Color.Success" OnClick="btnAddThird" Style="background-color: #00C853; color: white; width: 88px; height: 62px; font-size: 18pt;">+1/3</MudButton>
            </MudItem>
            <MudItem xs="4">
                <MudButton Variant="Variant.Filled" Color="Color.Success" OnClick="btnAddFourth" Style="background-color: #00C853; color: white; width: 88px; height: 62px; font-size: 18pt;">+1/4</MudButton>
            </MudItem>
                
            <MudItem xs="12">
                <MudItem>
                    <MudText Typo="Typo.h6" Align="Align.Center">Points: @(Math.Truncate(PointsService.pointsTotal * 100)/100)</MudText>
                </MudItem>
                <MudItem>
                    @if (PointsService.pointsTotal >= 0)
			        {
                        <MudProgressLinear Class="mt-4" Size="Size.Large" Rounded="true" Variant="Variant.Determinate" Value="@PointsService.pointsPartial" Color="Color.Success" Style="height: 35px;width: 345px;"/>
			        }
			        else
			        {
                        <MudProgressLinear Class="mt-4" Size="Size.Large" Rounded="true" Variant="Variant.Determinate" Value="@PointsService.pointsPartialFlipped" Color="Color.Error" Style="height: 35px;width: 345px;offset-rotate: reverse;"/>
			        }
                </MudItem>
            </MudItem>

            <MudItem xs="4">
                <MudButton Variant="Variant.Filled" Color="Color.Success" OnClick="btnSubWhole" Style="background-color: #F44336; color: white; width: 88px; height: 62px; font-size: 18pt;">-1</MudButton>
            </MudItem>
            <MudItem xs="4">
                <MudButton Variant="Variant.Filled" Color="Color.Success" OnClick="btnSubThird" Style="background-color: #F44336; color: white; width: 88px; height: 62px; font-size: 18pt;">-1/3</MudButton>
            </MudItem>
            <MudItem xs="4">
                <MudButton Variant="Variant.Filled" Color="Color.Success" OnClick="btnSubFourth" Style="background-color: #F44336; color: white; width: 88px; height: 62px; font-size: 18pt;">-1/4</MudButton>
            </MudItem>


            <MudItem xs="12">
                <MudPaper>
                    <MudText Typo="Typo.h6" Align="Align.Center">Game Controls</MudText>
                    <MudDivider></MudDivider>
                    <MudText Typo="Typo.body1" Align="Align.Center"></MudText>
                </MudPaper>
            </MudItem>

            <MudItem Class="ma-0" Style="height:500px;overflow: auto;">
                <MudGrid>
                    <MudItem xs="6">
                        <MudTextField Label="Local User" @bind-Value="GamesService.localPlayerName" Variant="Variant.Text" Style="height: 35px" />
                    </MudItem>
                    <MudItem xs="6">
                        <MudTextField Label="Remote User" @bind-Value="GamesService.remotePlayerName" Variant="Variant.Text" Style="height: 35px" />
                    </MudItem>
                </MudGrid>
            </MudItem>

        </MudGrid>
    </MudItem>

    @* Games *@
    <MudItem xs="5">
        <MudItem>
            @if (!GamesService.AutoGameRunning)
            {
            <MudSelect 
                Label="Select a game" @bind-Value="localGame" Variant="Variant.Filled" Color="Color.Primary" Style="width: 200px"
                           ReadOnly="@GamesService.AutoGameRunning" Adornment="Adornment.End" AdornmentIcon="@Icons.Material.Filled.CloudUpload" OnAdornmentClick="ChangeGame">
                    @foreach (Game game in GamesService.gamesList)
                {
                    <MudSelectItem Value="@game">@game.Name</MudSelectItem>
                }
            </MudSelect>
            }
            else
			{
                <MudText Typo="Typo.h6">Game: @GamesService.gameSelected.Name</MudText>
			}
        </MudItem>

        <br />

        <MudItem Class="ma-0" Style="height:700px;overflow: auto;">
            @foreach (Game.Line line in GamesService.gameSelected.Description)
            {
                if (line.text == "")
                {
                    <br />
                }
                else if (line.text.Contains("localPlayer") || line.text.Contains("remotePlayer"))
				{
                    string editedline = line.text.Replace("localPlayer", GamesService.localPlayerName).Replace("remotePlayer", GamesService.remotePlayerName);
                    <MudText Typo="line.typo">@editedline</MudText>
				}
                else
                {
                    <MudText Typo="line.typo">@line.text</MudText>
                }
            }
        </MudItem> 

    </MudItem>

    @* AutoGame Logs *@
    <MudItem Class="ma-0" Style="height:700px;overflow: auto;">

        <MudItem>
			<MudText Typo="Typo.h6">Point Logs</MudText>
		</MudItem>

        @foreach (LogEvent logevent in LogService.logEvents.OrderByDescending(e => e.time))
        {
            if (logevent.source == "Games & Points" && logevent.severity == Severity.Info)
			{
				<MudAlert Dense="true" Severity="Severity.Normal">@logevent.message</MudAlert>
			}
        }

    </MudItem>

</MudGrid>
